<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phishing Awareness Quiz</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="supabase.js"></script>
  <style>
    .quiz-container {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      text-align: center;
    }

    .question-box {
      margin: 30px auto;
      text-align: left;
      max-width: 700px;
    }

    .question-box h2 {
      color: #F76C5E;
      text-align: left;
      margin-bottom: 10px;
    }

    .question-box p {
      font-weight: bold;
      color: #2A6F74;
      font-size: 1.1rem;
      margin-bottom: 20px;
    }

    .options {
      margin-top: 10px;
    }

    .options label {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 12px 0;
      font-size: 1rem;
      color: #2A6F74;
      text-align: left;
    }

    .options input[type="radio"] {
      margin: 0;
    }

    .button-row {
      margin-top: 30px;
    }

    .quiz-btn {
      padding: 12px 24px;
      background-color: #F76C5E;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      margin: 10px 10px 0;
    }

    .quiz-btn:hover {
      background-color: #d95c4d;
    }

    .exit-btn {
      background-color: #2A6F74;
    }

    .exit-btn:hover {
      background-color: #21595f;
    }

    .exit-row {
      margin-top: 10px;
    }

    #timer-display {
      font-weight: bold;
      color: #2A6F74;
      margin-bottom: 10px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<nav>
  <img src="images/Hooked_logo_teal_transparent.png" alt="Hooked Logo" class="logo">
  <ul class="nav-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="games.html">Games</a></li>
    <li><a href="resources.html">Resources</a></li>
    <li><a href="quiz.html">Quiz</a></li>
  </ul>
  <div id="user-nav" style="margin-left: auto; padding-right: 20px; display: flex; align-items: center; gap: 10px;">
    <!-- Welcome and Logout will be injected here -->
  </div>
</nav>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const { data: { user } } = await supabase.auth.getUser();

    const userNav = document.getElementById("user-nav");
    userNav.innerHTML = ""; // Clear existing content

    if (user) {
      // Create welcome text span
      const welcomeSpan = document.createElement("span");
      welcomeSpan.style.fontWeight = "bold";
      welcomeSpan.style.color = "#2A6F74";
      welcomeSpan.textContent = `Welcome, ${user.user_metadata?.username || user.email}`;

      // Create logout button
      const logoutBtn = document.createElement("button");
      logoutBtn.textContent = "Logout";
      logoutBtn.style.backgroundColor = "#F76C5E";
      logoutBtn.style.color = "white";
      logoutBtn.style.border = "none";
      logoutBtn.style.padding = "6px 12px";
      logoutBtn.style.borderRadius = "6px";
      logoutBtn.style.cursor = "pointer";
      logoutBtn.style.fontSize = "0.9rem";

      logoutBtn.addEventListener("click", async () => {
        await supabase.auth.signOut();
        location.reload();
      });

      // Append welcome text and logout button to user-nav div
      userNav.appendChild(welcomeSpan);
      userNav.appendChild(logoutBtn);
    } else {
      // User not logged in, show Login / Sign Up links
      const loginLink = document.createElement("a");
      loginLink.href = "login.html";
      loginLink.textContent = "Log In";
      loginLink.style.color = "#2A6F74";
      loginLink.style.textDecoration = "none";
      loginLink.style.fontWeight = "bold";
      loginLink.style.marginRight = "10px";

      const signupLink = document.createElement("a");
      signupLink.href = "signup.html";
      signupLink.textContent = "Sign Up";
      signupLink.style.color = "#2A6F74";
      signupLink.style.textDecoration = "none";
      signupLink.style.fontWeight = "bold";

      userNav.appendChild(loginLink);
      userNav.appendChild(signupLink);
    }
  });
</script>


  <main class="quiz-container">
    <div id="start-screen">
      <h1>Phishing Awareness Quiz</h1>
      <p>Test your knowledge with 20 multiple-choice questions.<br>You must score 75% to pass!</p>
      <button class="quiz-btn" onclick="startQuiz()">Start Quiz</button>
    </div>

    <div id="quiz-screen" class="hidden">
      <div id="timer-display"></div>
      <div id="question-container"></div>
      <div class="button-row">
        <button id="prev-btn" class="quiz-btn" onclick="prevQuestion()" style="display: none;">Previous</button>
        <button id="next-btn" class="quiz-btn" onclick="nextQuestion()">Next</button>
      </div>
      <div class="exit-row">
        <button class="quiz-btn exit-btn" onclick="confirmExit()">Exit</button>
      </div>
    </div>

    <div id="review-screen" class="hidden">
      <h2>Review Your Answers</h2>
      <div id="review-container"></div>
      <h3 id="final-score"></h3>
      <p id="final-time"></p>
      <button class="quiz-btn" onclick="startQuiz()">Try Again</button>
      <button class="quiz-btn" onclick="window.location.href='index.html'">Return Home</button>
    </div>
  </main>

  <footer>
    <img src="images/Hooked_logo_with_tag_transparent.png" alt="Hooked Logo with Tagline" class="footer-logo" />
    <p>© 2025 Hooked? | Phishing Awareness Platform</p>
    <p>Created as part of a final year project at The Open University</p>
  </footer>

  <script>
    const questions = [
      { question: "What is a common sign of a phishing email?", options: ["A personal greeting with your full name", "An email from a known contact", "Poor spelling and grammar", "A secure URL starting with https://"], answer: 2 },
      { question: "What should you do if you receive a suspicious email?", options: ["Open it to see what it says", "Forward it to everyone you know", "Click any links to test them", "Report it and delete it"], answer: 3 },
      { question: "Phishing emails often create a sense of ______.", options: ["Humour", "Urgency", "Relief", "Celebration"], answer: 1 },
      { question: "What does HTTPS mean in a web address?", options: ["High Tech Page Server", "HyperText Transfer Protocol Secure", "Hacked Tech Protocol System", "Hosting Transfer Point Site"], answer: 1 },
      { question: "Why might a phishing email impersonate a trusted company?", options: ["To make it easier to understand", "To entertain users", "To trick recipients into trusting it", "To offer real deals"], answer: 2 },
      { question: "Which of these is a safe practice?", options: ["Clicking links from unknown senders", "Entering passwords on any website", "Using multi-factor authentication", "Ignoring software updates"], answer: 2 },
      { question: "What’s a red flag in a sender’s email address?", options: ["It matches your contacts", "It uses a familiar domain", "It has odd characters or misspellings", "It ends in .com"], answer: 2 },
      { question: "Phishing can happen through:", options: ["Emails only", "Text messages only", "Phone calls only", "All of the above"], answer: 3 },
      { question: "If a link looks suspicious, what should you do?", options: ["Click it quickly", "Hover to preview the URL", "Forward it", "Bookmark it"], answer: 1 },
      { question: "What does a phishing website usually try to steal?", options: ["Music preferences", "Bank details and passwords", "Favourite colour", "Weather info"], answer: 1 },
      { question: "Which of these messages is likely a phishing attempt?", options: ["Your account has been suspended! Click here to reactivate", "Weekly newsletter", "Thank you for your purchase", "Your subscription is due next month"], answer: 0 },
      { question: "What does multi-factor authentication do?", options: ["Makes your password longer", "Allows access from multiple devices", "Adds extra layers of security", "Sends your data to backup"], answer: 2 },
      { question: "Which type of file attachment might be suspicious?", options: [".jpg", ".txt", ".exe", ".doc"], answer: 2 },
      { question: "How often should you change your passwords?", options: ["Every 10 years", "Only if hacked", "Never", "Regularly and when suspicious activity is seen"], answer: 3 },
      { question: "What’s a safe way to check if a message is genuine?", options: ["Call the sender using a known number", "Reply directly to the message", "Click the link in the message", "Ignore it completely"], answer: 0 },
      { question: "Why do attackers use fake logos and branding?", options: ["To be creative", "To bypass spam filters", "To appear trustworthy", "To sell products"], answer: 2 },
      { question: "Which of these passwords is strongest?", options: ["Password123", "Summer2022", "G!v3m3Str0nGp@ss!", "qwerty"], answer: 2 },
      { question: "Phishing attacks are:", options: ["Always from other countries", "Completely avoidable", "Targeted or random", "Only against businesses"], answer: 2 },
      { question: "You clicked a phishing link. What should you do first?", options: ["Ignore it", "Reset your password and report it", "Turn off your computer", "Unplug your router"], answer: 1 },
      { question: "Where can you learn more about phishing prevention?", options: ["Gaming sites", "Fashion blogs", "National Cyber Security Centre", "Social media"], answer: 2 }
    ];

    let current = 0;
    let answers = [];
    let score = 0;
    let startTime, timerInterval;

    function startQuiz() {
      current = 0;
      answers = [];
      score = 0;
      document.getElementById("start-screen").classList.add("hidden");
      document.getElementById("review-screen").classList.add("hidden");
      document.getElementById("quiz-screen").classList.remove("hidden");

      startTime = new Date();
      updateTimer();
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
      loadQuestion();
    }

    function updateTimer() {
      const now = new Date();
      const elapsed = Math.floor((now - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      document.getElementById("timer-display").textContent = `⏱️ Time: ${minutes}m ${seconds}s`;
    }

    function loadQuestion() {
      const container = document.getElementById("question-container");
      const q = questions[current];
      container.innerHTML = `
        <div class="question-box">
          <h2>Question ${current + 1} of ${questions.length}</h2>
          <p><strong>${q.question}</strong></p>
          <div class="options">
            ${q.options.map((opt, idx) => `
              <label>
                <input type="radio" name="answer" value="${idx}" ${answers[current] == idx ? 'checked' : ''}>
                ${opt}
              </label>
            `).join('')}
          </div>
        </div>
      `;

      document.getElementById("prev-btn").style.display = current === 0 ? "none" : "inline-block";
    }

    function nextQuestion() {
      const selected = document.querySelector('input[name="answer"]:checked');
      if (!selected) {
        alert("Please select an answer before continuing.");
        return;
      }
      answers[current] = parseInt(selected.value);
      current++;
      if (current >= questions.length) {
        finishQuiz();
      } else {
        loadQuestion();
      }
    }

    function prevQuestion() {
      if (current > 0) {
        current--;
        loadQuestion();
      }
    }

    function confirmExit() {
      if (confirm("Do you really wish to exit the quiz? Your answers will not be saved.")) {
        window.location.href = "index.html";
      }
    }

    function finishQuiz() {
      clearInterval(timerInterval);
      document.getElementById("quiz-screen").classList.add("hidden");
      document.getElementById("review-screen").classList.remove("hidden");

      const review = document.getElementById("review-container");
      review.innerHTML = "";

      questions.forEach((q, idx) => {
        const isCorrect = q.answer === answers[idx];
        if (isCorrect) score++;
        const answerText = q.options[answers[idx]] || "<em>No answer</em>";
        review.innerHTML += `
          <p><strong>Q${idx + 1}:</strong> ${q.question}<br>
          <span style="color: ${isCorrect ? 'green' : 'red'};">Your answer: ${answerText}</span></p>
        `;
      });

      const percent = Math.round((score / questions.length) * 100);
      const pass = percent >= 75;
      const elapsedSeconds = Math.floor((new Date() - startTime) / 1000);
      const minutes = Math.floor(elapsedSeconds / 60);
      const seconds = elapsedSeconds % 60;

      document.getElementById("final-score").textContent = pass
        ? `✅ You scored ${percent}%. You passed!`
        : `❌ You scored ${percent}%. You did not pass.`;

      document.getElementById("final-time").textContent = `Elapsed time: ${minutes}m ${seconds}s`;
    }
  </script>
</body>
</html>
